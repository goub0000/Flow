# Nixpacks Configuration for Flutter Web + Node.js Server
# This configuration ensures Flutter SDK is available during build

[phases.setup]
nixPkgs = ["nodejs", "bash", "git", "curl", "unzip"]

[phases.install]
cmds = [
  # Install Flutter SDK
  "curl -O https://storage.googleapis.com/flutter_infra_release/releases/stable/linux/flutter_linux_3.27.0-stable.tar.xz",
  "tar xf flutter_linux_3.27.0-stable.tar.xz",
  "export PATH=\"$PATH:`pwd`/flutter/bin\"",
  "flutter doctor -v",
  "flutter --version",
  # Install npm dependencies
  "npm install"
]

[phases.build]
cmds = [
  "export PATH=\"$PATH:`pwd`/flutter/bin\"",
  "bash build.sh"
]

[start]
cmd = "node server.js"
